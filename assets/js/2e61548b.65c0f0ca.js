"use strict";(self.webpackChunktestkube_documentation=self.webpackChunktestkube_documentation||[]).push([[9051],{3905:(e,t,n)=>{n.d(t,{Zo:()=>i,kt:()=>b});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},i=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),d=l(n),b=a,m=d["".concat(c,".").concat(b)]||d[b]||p[b]||o;return n?r.createElement(m,u(u({ref:t},i),{},{components:n})):r.createElement(m,u({ref:t},i))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,u=new Array(o);u[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,u[1]=s;for(var l=2;l<o;l++)u[l]=n[l];return r.createElement.apply(null,u)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},62301:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>u,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(87462),a=(n(67294),n(3905));const o={},u="Kube no trouble",s={unversionedId:"test-types/executor-kubent",id:"test-types/executor-kubent",title:"Kube no trouble",description:"Kube No Trouble (kubent) is a simple tool to check whether you're using any of these API versions in your cluster and therefore should upgrade your workloads first, before upgrading your Kubernetes cluster.",source:"@site/docs/test-types/executor-kubent.mdx",sourceDirName:"test-types",slug:"/test-types/executor-kubent",permalink:"/test-types/executor-kubent",draft:!1,editUrl:"https://github.com/kubeshop/testkube/tree/develop/docs/docs/test-types/executor-kubent.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"KubePug",permalink:"/test-types/executor-kubepug"},next:{title:"Maven",permalink:"/test-types/executor-maven"}},c={},l=[{value:"Usage",id:"usage",level:2},{value:"Step 1 - Add the executor to Testkube",id:"step-1---add-the-executor-to-testkube",level:3},{value:"Step 2 - Add ServiceAccount for kubent",id:"step-2---add-serviceaccount-for-kubent",level:3},{value:"Step 3 - Update the Job Template to include the Service ServiceAccount",id:"step-3---update-the-job-template-to-include-the-service-serviceaccount",level:3},{value:"Step 4 - Create a test",id:"step-4---create-a-test",level:3}],i={toc:l};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"kube-no-trouble"},"Kube no trouble"),(0,a.kt)("p",null,"Kube No Trouble (kubent) is a simple tool to check whether you're using any of these API versions in your cluster and therefore should upgrade your workloads first, before upgrading your Kubernetes cluster."),(0,a.kt)("p",null,"You can run kubent with Testkube to use it in your automated tests for your Kubernetes clusters."),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"step-1---add-the-executor-to-testkube"},"Step 1 - Add the executor to Testkube"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"testkube create executor --name kubent-executor --types kubent\n--image ghcr.io/doitintl/kube-no-trouble:latest\n")),(0,a.kt)("h3",{id:"step-2---add-serviceaccount-for-kubent"},"Step 2 - Add ServiceAccount for kubent"),(0,a.kt)("p",null,"kubent needs to be able to list all the resources in the cluster. To do that, you need to create a ServiceAccount and a ClusterRoleBinding for it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kubent-sa.yaml"',title:'"kubent-sa.yaml"'},'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kubent\n  namespace: testkube\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: kubent-reader\n  namespace: testkube\nrules:\n- apiGroups: ["*"]\n  resources: ["*"]\n  verbs: ["get", "list"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubent-read-everything\n  namespace: testkube\nsubjects:\n- kind: ServiceAccount\n  name: kubent\n  namespace: testkube\nroleRef:\n  kind: ClusterRole\n  name: kubent-reader\n  apiGroup: rbac.authorization.k8s.io\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f kubent-sa.yaml\n")),(0,a.kt)("h3",{id:"step-3---update-the-job-template-to-include-the-service-serviceaccount"},"Step 3 - Update the Job Template to include the Service ServiceAccount"),(0,a.kt)("p",null,"Testkube allows you to override the Job template that will be used to run the tests. You can use this to add the ServiceAccount to the Job."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="job-template.yaml"',title:'"job-template.yaml"'},'apiVersion: batch/v1\nkind: Job\nmetadata: \n  name: "{{ .Name }}"\n  namespace: "{{ .Namespace }}"\nspec:\n  template:\n    spec:\n      restartPolicy: Never\n      serviceAccountName: kubent\n      containers:\n        - name: "{{ .Name }}"\n          image: "{{ .Image }}"\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"testkube update executor --name kubent-executor --job-template job-template.yaml\n")),(0,a.kt)("h3",{id:"step-4---create-a-test"},"Step 4 - Create a test"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"testkube create test --name kubent-test --type kubent\n")),(0,a.kt)("p",null,"And now run the test to see if you're using any of the deprecated API versions."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"testkube run test kubent-test\n")),(0,a.kt)("p",null,"If you look at the logs of the Job, you should see something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'$ testkube watch execution kubent-test-1\n\nGetting logs from test job 64820fce90a243e72062576c\n5:28PM INF Target K8s version is 1.27.1\n5:28PM INF Retrieved 6 resources from collector name=Cluster\n5:28PM INF Retrieved 69 resources from collector name="Helm v3"\n5:28PM INF Loaded ruleset name=custom.rego.tmpl\n5:28PM INF Loaded ruleset name=deprecated-1-16.rego\n5:28PM INF Loaded ruleset name=deprecated-1-22.rego\n5:28PM INF Loaded ruleset name=deprecated-1-25.rego\n5:28PM INF Loaded ruleset name=deprecated-1-26.rego\n5:28PM INF Loaded ruleset name=deprecated-future.rego\n\n.\nUse following command to get test execution details:\n$ kubectl testkube get execution 64820fce90a243e72062576c\n')))}p.isMDXComponent=!0}}]);