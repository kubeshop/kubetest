"use strict";(self.webpackChunktestkube_documentation=self.webpackChunktestkube_documentation||[]).push([[5756],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),u=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(a),m=r,k=d["".concat(o,".").concat(m)]||d[m]||p[m]||s;return a?n.createElement(k,l(l({ref:t},c),{},{components:a})):n.createElement(k,l({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,l=new Array(s);l[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<s;u++)l[u]=a[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},96471:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const s={},l="Artifacts",i={unversionedId:"articles/artifacts",id:"articles/artifacts",title:"Artifacts",description:"Storing Test Artifacts",source:"@site/docs/articles/artifacts.md",sourceDirName:"articles",slug:"/articles/artifacts",permalink:"/articles/artifacts",draft:!1,editUrl:"https://github.com/kubeshop/testkube/tree/develop/docs/docs/articles/artifacts.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Metrics",permalink:"/articles/metrics"},next:{title:"Dependencies for Testkube",permalink:"/articles/testkube-dependencies"}},o={},u=[{value:"Storing Test Artifacts",id:"storing-test-artifacts",level:2},{value:"Collecting Test Artifacts",id:"collecting-test-artifacts",level:2}],c={toc:u};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"artifacts"},"Artifacts"),(0,r.kt)("h2",{id:"storing-test-artifacts"},"Storing Test Artifacts"),(0,r.kt)("p",null,"Testkube allows you to save supported files generated by your tests, which we call ",(0,r.kt)("strong",{parentName:"p"},"Artifacts"),"."),(0,r.kt)("p",null,"The executor will scrape the files and store them in ",(0,r.kt)("a",{parentName:"p",href:"https://min.io/"},"Minio"),". The executor will create a bucket named by execution ID and collect all files that are stored in the location specific to each executor."),(0,r.kt)("p",null,"The available configuration parameters in Helm charts are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Is optional"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.endpoint"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"testkube-minio-service-testkube:9000"),(0,r.kt)("td",{parentName:"tr",align:null},"URL of the S3 bucket")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.accessKeyId"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"minio"),(0,r.kt)("td",{parentName:"tr",align:null},"Access Key ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.accessKey"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"minio123"),(0,r.kt)("td",{parentName:"tr",align:null},"Access Key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.location"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Region")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.token"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"S3 Token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.SSL"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"false"),(0,r.kt)("td",{parentName:"tr",align:null},"Indicates whether SSL communication is to be enabled.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.scrapperEnabled"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"true"),(0,r.kt)("td",{parentName:"tr",align:null},"Indicates whether executors should scrape artifacts.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"testkube-api.storage.compressArtifacts"),(0,r.kt)("td",{parentName:"tr",align:null},"yes"),(0,r.kt)("td",{parentName:"tr",align:null},"true"),(0,r.kt)("td",{parentName:"tr",align:null},"Indicates whether executors should compress artifacts.")))),(0,r.kt)("p",null,"The API Server accepts the following environment variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"STORAGE_ENDPOINT\nSTORAGE_BUCKET\nSTORAGE_ACCESSKEYID\nSTORAGE_SECRETACCESSKEY\nSTORAGE_LOCATION\nSTORAGE_REGION\nSTORAGE_TOKEN \nSTORAGE_SSL\nSCRAPPERENABLED\nCOMPRESSARTIFACTS\n")),(0,r.kt)("p",null,"Which can be set while installing with Helm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"helm install --create-namespace my-testkube kubeshop/testkube --set STORAGE_ENDPOINT=custom_value\n")),(0,r.kt)("p",null,"Alternatively, these values can be read from Kubernetes secrets and set:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- env:\n - name: STORAGE_ENDPOINT\n   secret:\n  secretName: test-secret\n")),(0,r.kt)("h2",{id:"collecting-test-artifacts"},"Collecting Test Artifacts"),(0,r.kt)("p",null,"For executors that produce files during test execution, Testkube supports collecting (scraping) these artifacts and storing them in our S3 compatible file storage. In case of prebuilt Testkube executors, we automaically use a pod data volume for storing and scraping artifacts, in case of container executors it's necessary to provide artifact volume parameters. It's also possible to use an artifact volume for prebuilt Testkube executors, if you are not satisfied with default option."),(0,r.kt)("p",null,"You can override the default volume mount path in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Test")," definition:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: test\n  namespace: testkube\nspec:\n  content:\n    repository:\n      authType: basic\n      branch: main\n      path: path/to/test/files\n      type: git\n      uri: https://git.repo.path.io/repo\n    type: git-dir\n  executionRequest:\n    artifactRequest:\n      sharedBetweenPods: true\n      storageClassName: standard-rwx\n      volumeMountPath: /data\n  type: cypress/project\n")),(0,r.kt)("p",null,"If you set the ",(0,r.kt)("inlineCode",{parentName:"p"},"volumeMountPath")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/data")," Testkube will set one volume as main for all pods "),(0,r.kt)("p",null,"Just keep in mind that all values need to be set: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"      sharedBetweenPods: true\n      storageClassName: standard-rwx\n      volumeMountPath: /data\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"storageClassName")," should be one which can support ",(0,r.kt)("inlineCode",{parentName:"p"},"ReadWriteMany")," access mode, like NFS or similar one.\nConsider checking your Kubernetes provider documentation for more information about which storage classes supports it.\nKeep in mind that the NFS based volumes can be significantly slower than local storage."),(0,r.kt)("p",null,"You can omit using explicit value of ",(0,r.kt)("inlineCode",{parentName:"p"},"storageClassName")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Test")," definition and use instead:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"      useDefaultStorageClassName: true\n")),(0,r.kt)("p",null,"In this case it's necessary to supply ",(0,r.kt)("inlineCode",{parentName:"p"},"defaultStorageClassName")," value in your helm chart values during installation."),(0,r.kt)("p",null,"It's possible to run the scraping process as a sidecar container of the test execution pod. Then you should avoid using volume parameters and provide ",(0,r.kt)("inlineCode",{parentName:"p"},"sidecarScraper")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Test")," definition like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"      sidecarScraper: true\n      dirs:\n        - /data/test/reports\n      masks:\n        - .*\\.txt,result.*\n")),(0,r.kt)("p",null,"You need to save test related files into specified directories on the dynamically created volume. They will be uploaded from there to Testkube file storage and available later for downloading using standard Testkube CLI or Testkube Dashboard commands. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: cli-container\n  namespace: testkube\nspec:\n  type: cli/container\n  executionRequest:\n    artifactRequest:\n      storageClassName: standard\n      volumeMountPath: /share\n      dirs:\n        - test/reports\n      masks:\n        - .*\\.txt,result.*\n      sharedBetweenPods: false\n")),(0,r.kt)("p",null,"You have to define the storage class name, volume mount path and directories in this volume with test artifacts.\nDefault volume mount path is ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/artifacts")," and directory is ",(0,r.kt)("inlineCode",{parentName:"p"},".")," .\nYou can define a mask for scraping only particular files with desired names or extensions.\nWe support sharing of an artifact volume between multiple pods for distributed prebuilt Testkube executors, like Jmeter. Make sure that this storage class supports ",(0,r.kt)("inlineCode",{parentName:"p"},"ReadWriteMany")," access mode, like NFS or similar one.\nMake sure your container executor definition has ",(0,r.kt)("inlineCode",{parentName:"p"},"artifacts")," feature. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: executor.testkube.io/v1\nkind: Executor\nmetadata:\n  name: cli-container-executor\n  namespace: testkube\nspec:\n  types:\n    - cli/container\n  executor_type: container\n  image: soleware/nx-cli:8.5.2\n  command:\n    - /bin/bash\n    - -c\n    - pwd; echo 'Change dir to /share'; cd /share; echo 'create test/reports'; mkdir -p test/reports; echo 'test data' > test/reports/result.txt\n  features:\n    - artifacts\n")),(0,r.kt)("p",null,"Run your test using the CLI command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"testkube run test cli-container\n")),(0,r.kt)("p",null,"Then get available artifacts for your test execution id:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"testkube get artifact 638a08b94ff1d2c694aeebf2\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="Expected output:"',title:'"Expected','output:"':!0},"  NAME       | SIZE (KB)\n-------------+------------\n  result.txt |        10\n")))}p.isMDXComponent=!0}}]);