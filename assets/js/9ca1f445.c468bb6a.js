"use strict";(self.webpackChunktestkube_documentation=self.webpackChunktestkube_documentation||[]).push([[2770],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,g=d["".concat(l,".").concat(m)]||d[m]||p[m]||s;return r?n.createElement(g,o(o({ref:t},c),{},{components:r})):n.createElement(g,o({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=r.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var u=2;u<s;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},85162:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(67294),a=r(86010);const s="tabItem_Ymn6";function o(e){let{children:t,hidden:r,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,a.Z)(s,o),hidden:r},t)}},74866:(e,t,r)=>{r.d(t,{Z:()=>T});var n=r(87462),a=r(67294),s=r(86010),o=r(12466),i=r(76775),l=r(91980),u=r(67392),c=r(50012);function p(e){return function(e){var t;return(null==(t=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:a}}=e;return{value:t,label:r,attributes:n,default:a}}))}function d(e){const{values:t,children:r}=e;return(0,a.useMemo)((()=>{const e=t??p(r);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function m(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:r}=e;const n=(0,i.k6)(),s=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,l._X)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})}),[s,n])]}function h(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,s=d(e),[o,i]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s}))),[l,u]=g({queryString:r,groupId:n}),[p,h]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,s]=(0,c.Nk)(r);return[n,(0,a.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:n}),b=(()=>{const e=l??p;return m({value:e,tabValues:s})?e:null})();(0,a.useLayoutEffect)((()=>{b&&i(b)}),[b]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),h(e)}),[u,h,s]),tabValues:s}}var b=r(72389);const k="tabList__CuJ",f="tabItem_LNqP";function v(e){let{className:t,block:r,selectedValue:i,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,r=c.indexOf(t),n=u[r].value;n!==i&&(p(t),l(n))},m=e=>{var t;let r=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;r=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;r=c[t]??c[c.length-1];break}}null==(t=r)||t.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":r},t)},u.map((e=>{let{value:t,label:r,attributes:o}=e;return a.createElement("li",(0,n.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},o,{className:(0,s.Z)("tabs__item",f,null==o?void 0:o.className,{"tabs__item--active":i===t})}),r??t)})))}function y(e){let{lazy:t,children:r,selectedValue:n}=e;const s=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function w(e){const t=h(e);return a.createElement("div",{className:(0,s.Z)("tabs-container",k)},a.createElement(v,(0,n.Z)({},e,t)),a.createElement(y,(0,n.Z)({},e,t)))}function T(e){const t=(0,b.Z)();return a.createElement(w,(0,n.Z)({key:String(t)},e))}},45967:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>u,toc:()=>p});var n=r(87462),a=(r(67294),r(3905)),s=r(74866),o=r(85162);const i={},l="Triggers",u={unversionedId:"articles/test-triggers",id:"articles/test-triggers",title:"Triggers",description:"Testkube allows you to automate running tests and test suites by defining triggers on certain events for various Kubernetes resources.",source:"@site/docs/articles/test-triggers.mdx",sourceDirName:"articles",slug:"/articles/test-triggers",permalink:"/articles/test-triggers",draft:!1,editUrl:"https://github.com/kubeshop/testkube/docs/docs/articles/test-triggers.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Scheduling Tests",permalink:"/articles/scheduling-tests"},next:{title:"Webhooks",permalink:"/articles/webhooks"}},c={},p=[{value:"What is a Testkube Test Trigger?",id:"what-is-a-testkube-test-trigger",level:2},{value:"Creating Test Triggers in the Testkube Dashboard",id:"creating-test-triggers-in-the-testkube-dashboard",level:2},{value:"Video Tutorial",id:"video-tutorial",level:2},{value:"What is a Testkube Test Trigger?",id:"what-is-a-testkube-test-trigger-1",level:2},{value:"Custom Resource Definition Model",id:"custom-resource-definition-model",level:2},{value:"Selectors",id:"selectors",level:3},{value:"Name Selector",id:"name-selector",level:4},{value:"Label Selector",id:"label-selector",level:4},{value:"Resource Conditions",id:"resource-conditions",level:3},{value:"Resource Probes",id:"resource-probes",level:3},{value:"Supported Values",id:"supported-values",level:3},{value:"Example",id:"example",level:2},{value:"Architecture",id:"architecture",level:2},{value:"API",id:"api",level:2},{value:"Video Tutorial",id:"video-tutorial-1",level:2}],d={toc:p};function m(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"triggers"},"Triggers"),(0,a.kt)(s.Z,{mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"dashboard",label:"Dashboard",default:!0,mdxType:"TabItem"},(0,a.kt)("p",null,"Testkube allows you to automate running tests and test suites by defining triggers on certain events for various Kubernetes resources."),(0,a.kt)("h2",{id:"what-is-a-testkube-test-trigger"},"What is a Testkube Test Trigger?"),(0,a.kt)("p",null,"In generic terms, a ",(0,a.kt)("em",{parentName:"p"},"Trigger")," defines an ",(0,a.kt)("em",{parentName:"p"},"action")," which will be executed for a given ",(0,a.kt)("em",{parentName:"p"},"execution")," when a certain ",(0,a.kt)("em",{parentName:"p"},"event")," on a specific ",(0,a.kt)("em",{parentName:"p"},"resource")," occurs. For example, we could define a ",(0,a.kt)("em",{parentName:"p"},"TestTrigger")," which ",(0,a.kt)("em",{parentName:"p"},"runs")," a ",(0,a.kt)("em",{parentName:"p"},"Test")," when a ",(0,a.kt)("em",{parentName:"p"},"ConfigMap")," gets ",(0,a.kt)("em",{parentName:"p"},"modified"),"."),(0,a.kt)("p",null,"Watch our ",(0,a.kt)("a",{parentName:"p",href:"#video-tutorial"},"video guide")," on using Testkube Test Triggers to perform ",(0,a.kt)("strong",{parentName:"p"},"Asynchronous Testing in Kubernetes"),"."),(0,a.kt)("h2",{id:"creating-test-triggers-in-the-testkube-dashboard"},"Creating Test Triggers in the Testkube Dashboard"),(0,a.kt)("p",null,"Click on the lightening bolt icon on the left of the Testkube IDE to open the dialog to create test triggers. Any current test triggers will be listed and the ",(0,a.kt)("inlineCode",{parentName:"p"},"Create a new trigger")," button is at the top right of the screen."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Trigger Screen",src:r(54395).Z,width:"2874",height:"1566"})),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Create new trigger")," dialog opens:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Create Trigger",src:r(81249).Z,width:"2874",height:"1568"})),(0,a.kt)("p",null,"Input the condition that will cause the trigger and click ",(0,a.kt)("inlineCode",{parentName:"p"},"Next"),"."),(0,a.kt)("p",null,"Input the action that will be the result of the trigger condition happening and click ",(0,a.kt)("inlineCode",{parentName:"p"},"Create"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Create Trigger Action",src:r(34354).Z,width:"2874",height:"1568"})),(0,a.kt)("p",null,"Get all the details in the video below!"),(0,a.kt)("h2",{id:"video-tutorial"},"Video Tutorial"),(0,a.kt)("iframe",{width:"100%",height:"350px",src:"https://www.youtube.com/embed/t4V6E9rQ5W4",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})),(0,a.kt)(o.Z,{value:"cli",label:"CLI",mdxType:"TabItem"},(0,a.kt)("p",null,"Testkube allows you to automate running tests and test suites by defining triggers on certain events for various Kubernetes resources."),(0,a.kt)("h2",{id:"what-is-a-testkube-test-trigger-1"},"What is a Testkube Test Trigger?"),(0,a.kt)("p",null,"In generic terms, a ",(0,a.kt)("em",{parentName:"p"},"Trigger")," defines an ",(0,a.kt)("em",{parentName:"p"},"action")," which will be executed for a given ",(0,a.kt)("em",{parentName:"p"},"execution")," when a certain ",(0,a.kt)("em",{parentName:"p"},"event")," on a specific ",(0,a.kt)("em",{parentName:"p"},"resource")," occurs having a given ",(0,a.kt)("em",{parentName:"p"},"concurrencyPolicy"),". For example, we could define a ",(0,a.kt)("em",{parentName:"p"},"TestTrigger")," which ",(0,a.kt)("em",{parentName:"p"},"runs")," a ",(0,a.kt)("em",{parentName:"p"},"Test")," when a ",(0,a.kt)("em",{parentName:"p"},"ConfigMap")," gets ",(0,a.kt)("em",{parentName:"p"},"modified"),"."),(0,a.kt)("p",null,"Watch our ",(0,a.kt)("a",{parentName:"p",href:"#video-tutorial"},"video guide")," on using Testkube Test Triggers to perform ",(0,a.kt)("strong",{parentName:"p"},"Asynchronous Testing in Kubernetes"),"."),(0,a.kt)("h2",{id:"custom-resource-definition-model"},"Custom Resource Definition Model"),(0,a.kt)("h3",{id:"selectors"},"Selectors"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"resourceSelector")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"testSelector")," fields support selecting resources either by name or using\nthe Kubernetes ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements"},"Label Selector"),"."),(0,a.kt)("p",null,"Each selector should specify the ",(0,a.kt)("inlineCode",{parentName:"p"},"namespace")," of the object, otherwise the namespace defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"testkube"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"selector := resourceSelector | testSelector\n")),(0,a.kt)("h4",{id:"name-selector"},"Name Selector"),(0,a.kt)("p",null,"Name selectors are used when we want to select a specific resource in a specific namespace."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"selector:\n  name: Kubernetes object name\n  namespace: Kubernetes object namespace (default is **testkube**)\n")),(0,a.kt)("h4",{id:"label-selector"},"Label Selector"),(0,a.kt)("p",null,"Label selectors are used when we want to select a group of resources in a specific namespace."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"selector:\n  namespace: Kubernetes object namespace (default is **testkube**)\n  labelSelector:\n    matchLabels: map of key-value pairs\n    matchExpressions:\n      - key: label name\n        operator: [In | NotIn | Exists | DoesNotExist\n        values: list of values\n")),(0,a.kt)("h3",{id:"resource-conditions"},"Resource Conditions"),(0,a.kt)("p",null,"Resource Conditions allows triggers to be defined based on the status conditions for a specific resource."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"conditionSpec:\n    timeout: duration in seconds the test trigger waits for conditions, until its stopped\n    delay: duration in seconds the test trigger waits between condition checks      \n    conditions:\n    - type: test trigger condition type\n      status: test trigger condition status, supported values - True, False, Unknown\n      reason: test trigger condition reason\n      ttl: test trigger condition ttl\n")),(0,a.kt)("h3",{id:"resource-probes"},"Resource Probes"),(0,a.kt)("p",null,"Resource Probes allows triggers to be defined based on the probe status."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"probeSpec:\n    timeout: duration in seconds the test trigger waits for probes, until its stopped\n    delay: duration in seconds the test trigger waits between probes\n    probes:\n    - scheme: test trigger condition probe scheme to connect to host, default is http\n      host: test trigger condition probe host, default is pod ip or service name\n      path: test trigger condition probe path to check, default is /\n      port: test trigger condition probe port to connect\n      headers: test trigger condition probe headers to submit\n")),(0,a.kt)("h3",{id:"supported-values"},"Supported Values"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Resource"),"          - pod, deployment, statefulset, daemonset, service, ingress, event, configmap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Action"),"            - run"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Event"),"             - created, modified, deleted"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Execution"),"         - test, testsuite"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"ConcurrencyPolicy")," - allow, forbid, replace")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"NOTE"),": All resources support the above-mentioned events, a list of finer-grained events is in the works, stay tuned..."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"Here is an example for a ",(0,a.kt)("strong",{parentName:"p"},"Test Trigger")," ",(0,a.kt)("em",{parentName:"p"},"default/testtrigger-example")," which runs the ",(0,a.kt)("strong",{parentName:"p"},"TestSuite")," ",(0,a.kt)("em",{parentName:"p"},"frontend/sanity-test"),"\nwhen a ",(0,a.kt)("strong",{parentName:"p"},"deployment")," containing the label ",(0,a.kt)("strong",{parentName:"p"},"testkube.io/tier: backend")," gets ",(0,a.kt)("strong",{parentName:"p"},"modified")," and also has the conditions ",(0,a.kt)("strong",{parentName:"p"},"Progressing: True: NewReplicaSetAvailable")," and ",(0,a.kt)("strong",{parentName:"p"},"Available: True"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: tests.testkube.io/v1\nkind: TestTrigger\nmetadata:\n  name: testtrigger-example\n  namespace: default\nspec:\n  resource: deployment\n  resourceSelector:\n    labelSelector:\n      matchLabels:\n        testkube.io/tier: backend\n  event: modified\n  conditionSpec:\n    timeout: 100\n    delay: 2\n    conditions:\n    - type: Progressing\n      status: "True"\n      reason: "NewReplicaSetAvailable"\n      ttl: 60\n    - type: Available\n      status: "True"\n  probeSpec:\n    timeout: 50\n    delay: 1\n    probes:\n    - scheme: http\n      host: testkube-api-server\n      path: /health\n      port: 8088\n      headers:\n        X-Token: "12345"\n    - host: testkube-dashboard\n      port: 8080     \n  action: run\n  execution: testsuite\n  concurrencyPolicy: allow\n  testSelector:\n    name: sanity-test\n    namespace: frontend\n')),(0,a.kt)("h2",{id:"architecture"},"Architecture"),(0,a.kt)("p",null,"Testkube uses ",(0,a.kt)("a",{parentName:"p",href:"https://pkg.go.dev/k8s.io/client-go/informers"},"Informers")," to watch Kubernetes resources and register handlers\non certain actions on the watched Kubernetes resources."),(0,a.kt)("p",null,"Informers are a reliable, scalable and fault-tolerant Kubernetes concept where each informer registers handlers with the\nKubernetes API and gets notified by Kubernetes on each event on the watched resources."),(0,a.kt)("h2",{id:"api"},"API"),(0,a.kt)("p",null,"Testkube exposes CRUD operations on test triggers in the REST API. Check out the ",(0,a.kt)("a",{parentName:"p",href:"/openapi"},"Open API")," docs for more info."),(0,a.kt)("h2",{id:"video-tutorial-1"},"Video Tutorial"),(0,a.kt)("iframe",{width:"100%",height:"350px",src:"https://www.youtube.com/embed/t4V6E9rQ5W4",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}))))}m.isMDXComponent=!0},81249:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/create-trigger-1.14-715d24f8ba1ea321fc86f1e3582b259b.png"},34354:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/create-trigger-action-1.14-39eb7758bbce0066076e1cc184a9c234.png"},54395:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/trigger-screen-1.14-650926c31177710749cc991055986c01.png"}}]);